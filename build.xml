<project name="CSS Compressor" default="run">
    <property name="dir.lib" value="${basedir}/lib" />
    <property name="dir.tmp" value="${basedir}/tmp" />

    <fail unless="dir.source" message="Property 'dir.source' must be specified!"/>
    <property name="dir.source" value="${dir.source}" />

    <!-- 获取父级build.xml指定的参数 -->
    <condition property="dir.output" value="${dir.output}" else="output">
        <isset property="dir.output" />
    </condition>
    <condition property="file.destname" value="${file.destname}" else="script">
        <isset property="file.destname" />
    </condition>
    <condition property="file.includes" value="${file.includes}" else="*.css">
        <isset property="file.includes" />
    </condition>
    <condition property="file.excludes" value="${file.excludes}" else="">
        <isset property="file.excludes" />
    </condition>

    <target name="init">
        <tstamp />
        <echo>Building...</echo>
        <mkdir dir="${dir.tmp}" />
        <mkdir dir="${dir.source}" />
        <mkdir dir="${dir.output}" />
    </target>

    <target name="concat">
        <echo>Concat...</echo>
        <concat destfile="${dir.tmp}/${file.destname}.css">
            <fileset dir="${dir.source}"
                     includes="${file.includes}"
                     excludes="${file.destname}.min.css, ${file.excludes}"
            />
        </concat>
    </target>

    <target name="compress">
        <echo>Compressing...</echo>
        <property name="yui-compressor" value="${dir.lib}/yuicompressor-2.4.6.jar" />
        <apply executable="java" dest="${dir.output}">
            <fileset dir="${dir.tmp}" includes="${file.destname}.css" />
            <arg line="-jar" />
            <arg path="${yui-compressor}" />
            <arg line="--type css --charset UTF-8 --verbose -o" />
            <targetfile />
            <mapper type="glob" from="*.css" to="*.min.css" />
        </apply>
    </target>

    <target name="clean">
        <delete>
            <fileset dir="${dir.tmp}" includes="*.css" />
        </delete>
    </target>

    <target name="run" depends="init, concat, compress, clean" />
</project>